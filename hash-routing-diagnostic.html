<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>GitHub Pages Hash Routing Diagnostic</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      color: #333;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      color: #333;
    }
    .diagnostic-panel {
      background: #f5f5f5;
      border-left: 4px solid #4285f4;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 4px 4px 0;
      overflow-x: auto;
    }
    .success { color: green; }
    .warning { color: orange; }
    .error { color: red; }
    button {
      background: #4285f4;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      margin: 5px;
      cursor: pointer;
    }
    button:hover { background: #3367d6; }
    code {
      background: #f0f0f0;
      padding: 2px 5px;
      border-radius: 3px;
      font-family: monospace;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }
    th, td {
      text-align: left;
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <div class="container">
    <h1>GitHub Pages Hash Routing Diagnostic</h1>
    <p>This page helps diagnose routing issues with Angular applications using hash routing on GitHub Pages.</p>
    
    <div class="diagnostic-panel">
      <h2>Current Environment</h2>
      <div id="environment-info"></div>
    </div>
    
    <div class="diagnostic-panel">
      <h2>Navigation Tests</h2>
      <button onclick="testNavigation('/')">Test Root Navigation</button>
      <button onclick="testNavigation('/#/')">Test Hash Root</button>
      <button onclick="testNavigation('/ida/')">Test /ida/ Path</button>
      <button onclick="testNavigation('/ida/#/')">Test /ida/#/ Path</button>
      <div id="navigation-results"></div>
    </div>
    
    <div class="diagnostic-panel">
      <h2>Redirect Test</h2>
      <button onclick="checkRedirectLoop()">Check for Redirect Loop</button>
      <div id="redirect-test"></div>
    </div>
    
    <div class="diagnostic-panel">
      <h2>Browser Console</h2>
      <p>Open your browser's developer console (F12) to see detailed logs.</p>
    </div>
    
    <h2>Recommendations</h2>
    <ul id="recommendations">
      <li>Use hash-based routing with <code>HashLocationStrategy</code> for GitHub Pages</li>
      <li>Ensure all links in the app use <code>#/route</code> format</li>
      <li>Set <code>APP_BASE_HREF</code> to <code>/ida/</code> for GitHub Pages</li>
      <li>Have a simple redirect from 404.html to <code>/ida/#/</code></li>
    </ul>
  </div>

  <script>
    // Environment info
    function updateEnvironmentInfo() {
      const url = window.location.href;
      const hostname = window.location.hostname;
      const pathname = window.location.pathname;
      const hash = window.location.hash;
      const isGitHubPages = hostname.includes('github.io');
      
      let html = `
        <table>
          <tr><th>Property</th><th>Value</th></tr>
          <tr><td>Full URL</td><td>${url}</td></tr>
          <tr><td>Hostname</td><td>${hostname} ${isGitHubPages ? '<span class="success">(GitHub Pages)</span>' : ''}</td></tr>
          <tr><td>Pathname</td><td>${pathname}</td></tr>
          <tr><td>Hash</td><td>${hash || '(none)'}</td></tr>
        </table>
      `;
      
      document.getElementById('environment-info').innerHTML = html;
    }
    
    // Navigation test
    function testNavigation(path) {
      const baseUrl = window.location.origin;
      const fullUrl = baseUrl + path;
      
      document.getElementById('navigation-results').innerHTML = 
        `<p>Navigating to: <code>${fullUrl}</code>...</p>`;
      
      // Store current URL to detect if we return here (potential loop)
      localStorage.setItem('diagnosticPrevUrl', window.location.href);
      localStorage.setItem('diagnosticTestTime', new Date().getTime());
      
      // Navigate
      window.location.href = fullUrl;
    }
    
    // Check for redirect loops
    function checkRedirectLoop() {
      const prevUrl = localStorage.getItem('diagnosticPrevUrl');
      const testTime = localStorage.getItem('diagnosticTestTime');
      const now = new Date().getTime();
      
      if (prevUrl && testTime) {
        const timeDiff = now - parseInt(testTime);
        const isSameUrl = prevUrl === window.location.href;
        const isQuickReturn = timeDiff < 3000; // Less than 3 seconds
        
        let status, message;
        
        if (isSameUrl && isQuickReturn) {
          status = 'error';
          message = `Potential redirect loop detected! Returned to same URL in ${timeDiff}ms`;
        } else if (isSameUrl) {
          status = 'warning';
          message = `Returned to same URL after ${timeDiff}ms (manual navigation?)`;
        } else {
          status = 'success';
          message = `No redirect loop detected. Last navigation was to ${prevUrl}`;
        }
        
        document.getElementById('redirect-test').innerHTML = 
          `<p class="${status}">${message}</p>`;
        
        // Clear test data
        localStorage.removeItem('diagnosticPrevUrl');
        localStorage.removeItem('diagnosticTestTime');
      } else {
        document.getElementById('redirect-test').innerHTML = 
          `<p>No previous navigation detected. Try a navigation test first.</p>`;
      }
    }
    
    // Initialize
    updateEnvironmentInfo();
    
    // Check if we just returned from a test
    window.addEventListener('load', function() {
      const prevUrl = localStorage.getItem('diagnosticPrevUrl');
      const testTime = localStorage.getItem('diagnosticTestTime');
      
      if (prevUrl && testTime) {
        const now = new Date().getTime();
        const timeDiff = now - parseInt(testTime);
        checkRedirectLoop();
      }
    });
  </script>
</body>
</html>
